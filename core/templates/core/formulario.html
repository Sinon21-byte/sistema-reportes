{% extends 'base.html' %}
{% load form_tags %}

{% block title %}Generar Reporte – Aediles{% endblock %}

{% block content %}
  <h1>Generar Reporte</h1>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.non_field_errors }}

    <!-- Metadatos -->
    <div class="form-group">
      {{ form.fecha.label_tag }}
      {{ form.fecha|add_class:"form-control" }}
      {{ form.fecha.errors }}
    </div>
    <div class="form-group">
      {{ form.nombre.label_tag }}
      {{ form.nombre|add_class:"form-control" }}
      {{ form.nombre.errors }}
    </div>
    <div class="form-group">
      {{ form.parque.label_tag }}
      {{ form.parque|add_class:"form-control" }}
      {{ form.parque.errors }}
    </div>

    <hr>

    <!-- Resto de campos: inspecciones, comentarios e imágenes -->
    {% for field in form.visible_fields %}
      <div class="form-group">
        {{ field.label_tag }}
        {{ field|add_class:"form-control" }}
        {{ field.errors }}
      </div>
    {% endfor %}

    <button type="submit" class="btn-primary">Generar Informe</button>
  </form>

  <script>
    // En móviles: antes de abrir el file-picker, pregunto Cámara o Galería
    document.addEventListener('DOMContentLoaded', function() {
      const fileInputs = document.querySelectorAll('input[type=file]');
      fileInputs.forEach(function(input) {
        input.addEventListener('click', function(ev) {
          // Sólo en móvil y con accept="image/*"
          if (input.accept.includes('image')) {
            ev.preventDefault();
            const useCamera = confirm(
              '¿Deseas tomar una foto nueva? Pulsa OK para Cámara, Cancel para Galería.'
            );
            if (useCamera) {
              input.setAttribute('capture', 'environment');
            } else {
              input.removeAttribute('capture');
            }
            input.click();
          }
        });
      });
    });
  </script>
{% endblock %}
